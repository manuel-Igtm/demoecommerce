pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Setup') {
            steps {
                sh '''
                    echo "=== Python Environment ==="
                    python3 --version
                    pip3 --version
                    echo "=== Project Structure ==="
                    ls -la ecommerce/
                '''
            }
        }
        
        stage('Install Dependencies') {
            steps {
                sh '''
                    cd ecommerce
                    echo "=== Installing Requirements ==="
                    pip3 install -r requirements.txt
                    echo "=== Installation Complete ==="
                '''
            }
        }
        
        stage('Django Checks') {
            steps {
                sh '''
                    cd ecommerce
                    echo "=== Django System Check ==="
                    python3 manage.py check
                    
                    echo "=== Migration Check ==="
                    python3 manage.py makemigrations --check --dry-run
                '''
            }
        }
        
        stage('Run Tests') {
            steps {
                sh '''
                    cd ecommerce
                    echo "=== Running Tests ==="
                    python3 manage.py test --verbosity=2
                '''
            }
        }
    }
    
    post {
        always {
            echo "Pipeline completed"
        }
        success {
            echo "✅ Success!"
        }
        failure {
            echo "❌ Failed!"
        }
    }
}